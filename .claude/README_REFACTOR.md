# 🔧 プロジェクト全体リファクタリングコマンド

UIと処理に影響しないコード品質向上のためのカスタムリファクタリングコマンド群

## 🎯 概要

このカスタムコマンドは以下の原則に基づいてプロジェクト全体をリファクタリングします：

- ✅ **UIに影響なし** - 見た目や動作は一切変更しません
- ✅ **処理ロジック保持** - 既存の機能は完全に保持されます
- ✅ **段階的実行** - 安全に段階的にリファクタリングを実行
- ✅ **自動バックアップ** - 変更前の状態を自動保存
- ✅ **専門エージェント連携** - Claude Codeの各専門エージェントを活用

## 📋 利用可能なコマンド

### `/refactor` - メインリファクタリングコマンド

```bash
# 全体分析のみ実行（推奨：最初に実行）
/refactor --analyze-only

# 型定義の最適化のみ（低リスク）
/refactor --types

# ユーティリティ関数の共通化のみ（中リスク）
/refactor --utils

# コンポーネントの分割・最適化のみ（高リスク・高効果）
/refactor --components

# 全体リファクタリング実行
/refactor --all
```

### `/analyze` - 詳細コード分析

```bash
# プロジェクト全体分析
/analyze

# 特定カテゴリのみ分析
/analyze --categories components types

# カスタムレポート出力
/analyze --output my_analysis_report.md
```

## 🔍 分析・検出項目

### 📊 コード統計
- ファイル数・行数統計
- 大きすぎるファイル検出（300行以上）
- ディレクトリ別ファイル分布

### 🔍 コード品質問題
- **重複コード**: 同名関数、類似パターン
- **型安全性**: any型使用箇所、インライン interface
- **インポート**: 未使用インポート、長すぎるパス
- **コンポーネント**: 大きすぎるコンポーネント、複雑な状態管理
- **複雑性**: 深いネスト、長すぎる関数

### 🎯 リファクタリング提案
- 優先度付きの改善提案
- 推定工数と期待効果
- 段階的実行プラン

## 🛠️ リファクタリング内容

### 1. 型安全性向上（優先度：高、リスク：低）
- `any` 型を適切な型定義に置換
- インライン `interface` を `types/` ディレクトリに移動
- 型推論の活用とジェネリクス最適化

### 2. インポート最適化（優先度：高、リスク：低）
- 未使用インポートの削除
- 長すぎるインポートパスの短縮
- 共通インポートの `index.ts` 化

### 3. ユーティリティ関数共通化（優先度：中、リスク：中）
- 重複するインライン関数の抽出
- `lib/utils/` への適切な配置
- 関数の再利用性向上

### 4. コンポーネント分割（優先度：中、リスク：高）
- 大きすぎるコンポーネント（200行以上）の分割
- 再利用可能な小さなコンポーネントへの分解
- 適切なコンポーネント階層の構築

### 5. 状態管理最適化（優先度：低、リスク：高）
- 複雑な状態管理のカスタムフック化
- `useState` が多すぎるコンポーネントの整理
- 状態ロジックの分離と再利用

## 🚀 使用方法

### ⭐ 推奨方法: 段階的自動リファクタリング
```bash
# 🎯 この1つのコマンドですべて実行（推奨）
/refactor
```

このコマンド1つで以下を**段階的に自動実行**：
1. **ステップ1**: 型定義最適化（低リスク）
2. **ステップ2**: ユーティリティ共通化（中リスク）  
3. **ステップ3**: コンポーネント分割（高リスク・高効果）

各ステップ後に確認を求められるので、安全に実行できます。

### 個別実行（必要に応じて）
```bash
# 分析のみ
/refactor --analyze-only

# 型安全性向上のみ
/refactor --types

# ユーティリティ共通化のみ
/refactor --utils

# コンポーネント最適化のみ
/refactor --components
```

## 📁 生成されるファイル

- `refactor_report_YYYYMMDD_HHMMSS.md` - 詳細分析レポート
- `.refactor_backup_YYYYMMDD_HHMMSS/` - 自動バックアップ
- `analysis_results.json` - 分析結果データ（内部使用）

## 🤖 連携エージェント

### TypeScript Pro (`typescript-pro`)
**専門分野**: 高度な型システムとTypeScript最適化
- 🎯 **any型の具体的な型への置換**
- 🎯 **ジェネリクス型の最適化**
- 🎯 **インライン interface の types/ ディレクトリ移動**
- 🎯 **型推論の活用によるコードクリーンアップ**
- 🎯 **严格な型安全性の確保**

### JavaScript Pro (`javascript-pro`)
**専門分野**: モダンJavaScriptとユーティリティ関数
- 🛠️ **ES6+モダン記法の活用**
- 🛠️ **重複するインライン関数の抽出・共通化**
- 🛠️ **lib/utils/ への適切な配置と分類**
- 🛠️ **非同期処理の最適化**
- 🛠️ **関数の再利用性向上**

### Frontend Developer (`frontend-developer`)
**専門分野**: React コンポーネント最適化とUI/UX
- 🧩 **大きすぎるコンポーネントの分割**
- 🧩 **再利用可能な小さなコンポーネントへの分解**
- 🧩 **複雑な状態管理のカスタムフック化**
- 🧩 **パフォーマンス最適化（memo化等）**
- 🧩 **レスポンシブデザインとアクセシビリティ保持**

### Code Reviewer (`code-reviewer`) - 補助エージェント
**専門分野**: 品質確保とベストプラクティス適用
- 🔍 **リファクタリング結果の品質レビュー**
- 🔍 **セキュリティチェック**
- 🔍 **保守性の評価**

### Architecture Reviewer (`architect-reviewer`) - 補助エージェント
**専門分野**: アーキテクチャ一貫性と設計パターン
- 🏗️ **コンポーネント分割の妥当性確認**
- 🏗️ **依存関係の最適化**
- 🏗️ **SOLID原則の適用確認**

## ⚠️ 注意事項

### 安全性
- 必ず `--analyze-only` で事前確認
- 重要な変更前にはバックアップ確認
- 段階的実行を推奨（一度に全てやらない）
- テスト実行で動作確認

### 制限事項
- 大きな変更は手動確認が必要
- コンポーネント分割は慎重に実行
- 外部ライブラリの変更は対象外

## 📊 効果測定

### 定量的効果
- コード行数の最適化
- ファイル数の適正化
- 重複コードの削減率
- 型安全性の向上度

### 定性的効果
- コードの可読性向上
- 保守性の向上
- 新機能開発の効率化
- バグ発生率の削減

## 🔧 カスタマイズ

設定ファイル `.claude/commands.json` で以下をカスタマイズ可能：

- 分析対象ファイルのパターン
- 検出する問題の閾値
- リファクタリングルール
- エージェント呼び出し設定

## 📞 トラブルシューティング

### よくある問題

**Q: リファクタリング後にテストが失敗する**
A: バックアップから復元し、段階的に実行してください

**Q: 大きな変更で不安**
A: `--analyze-only` で事前確認し、小さな単位で実行してください

**Q: エージェントが応答しない**
A: ファイル数を減らして再実行するか、手動で分割して実行してください

### サポート
- 詳細なログは生成されるレポートを確認
- 問題があれば自動バックアップから復元可能
- Claude Codeの他のエージェントと組み合わせて使用可能

---

*このカスタムコマンドは sedori-app プロジェクト専用に設計されています*