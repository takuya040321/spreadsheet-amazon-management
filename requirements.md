# Amazonセラーセントラル売上データ自動転記システム - 要件定義書

## 1. プロジェクト概要

### 1.1 システム概要
Amazonセラーセントラルのペイメントレポート（レポートリポジトリ、CSV形式）を自動読み込みし、商品管理シートに売上情報を転記するGoogle Apps Scriptベースのシステム。月次販売実績レポート（CSV形式）を自動読み込みし、商品管理シートに売上情報を転記するGoogle Apps Scriptベースのシステム。

### 1.2 目的
- Amazonの売上データを手動で転記する作業を自動化
- 商品管理の効率化と転記ミスの削減
- GitHubでのバージョン管理による開発・運用の効率化

## 2. 機能要件

### 2.1 主要機能
1. **CSVファイル読込機能**
2. **転記先行検索・データ処理機能**
3. **商品管理シート転記機能**

### 2.2 機能詳細

#### 2.2.1 CSVファイル読込機能
- **トリガー**: ボタン1クリックによる手動実行
- **UI表示**: Google Driveファイル選択ダイアログ表示
- **ファイル選択**: Amazonペイメントレポート（レポートリポジトリ）CSVの選択
- **データ読込範囲**: CSVファイルのA列9行目からすべての行列を読込
- **データ配置**: 読み込んだデータを「Amazon売上」シートの最終行G列から転記
- **重複チェック**: 既存データとの重複を検出し、重複時は処理スキップ・警告表示

#### 2.2.2 転記先行検索・データ処理機能
- **トリガー**: ボタン2クリックによる手動実行

**対象行抽出条件**
- 3行目以降が対象
- A列が空白でない行を処理対象とする

**トランザクション種類別処理（H列の値に基づく）**

1. **FBA在庫関連の手数料**: A列を転記対象外に設定
2. **振込み**: A列を転記対象外に設定
3. **注文外料金**: A列を転記対象外に設定
4. **配送サービス**: 処理なし
5. **調整**: K列商品名による分岐処理
   - "FBA在庫の返金 - 購入者による返品:": A列を転記対象外
   - その他（紛失関連）: SKU検索・行番号記録処理（SKU未発見時は処理スキップ）
6. **返金**: 注文番号検索・ステータス更新処理（注文番号未発見時は処理スキップ）
7. **注文**: SKU検索・行番号記録処理（SKU未発見時は処理スキップ）

**商品管理シート検索条件**
- A列ステータス値（IFS関数による動的値）：
  - "1.商品未受領": Z列=FALSE
  - "2.受領/検品済": Z列=TRUE
  - "3.販売中": AA列=TRUE  
  - "4.販売/処分済": AF列=TRUE
- 検索対象：「4.販売/処分済」以外のステータス

**エラーハンドリング**
- SKU検索で該当なし：処理スキップ（A列・B列への記録なし）
- 注文番号検索で該当なし：処理スキップ

**共通後処理**
- D列に処理実行日付（YYYY/MM/DD形式）を記録

#### 2.2.3 商品管理シート転記機能
- **トリガー**: ボタン3クリックによる手動実行

**売上データ転記処理**
- AB列（売上日）: F列の日付をYYYY/MM/DD形式で転記
- AC列（販売価格）: S列＋T列の合計値を転記
- AD列（入金価格）: AG列の値を転記
- AF列（売却廃却）: チェックボックスをTrueに設定

**配送サービス処理**
- H列が「配送サービス」の場合の特別処理
- I列・AG列データを取得し商品管理シートのAE列に転記

**処理日時記録**
- E列に処理実行日をYYYY/MM/DD形式で記録

## 3. システム構成

### 3.1 UI構成
- **ボタン1**: 「CSVファイル読込」- Amazon売上レポートの読込処理実行
- **ボタン2**: 「データ処理」- 転記先行検索・データ処理実行  
- **ボタン3**: 「商品管理転記」- 商品管理シートへの転記処理実行

### 3.2 処理フロー
1. ボタン1でCSVデータをAmazon売上シートに読込
2. ボタン2でトランザクション種類別のデータ処理を実行
3. ボタン3で商品管理シートに売上情報を転記

## 4. 非機能要件

### 4.1 性能要件
- CSV読込処理時間: 1ファイルあたり30秒以内
- データ転記処理時間: 1000行あたり60秒以内
- UIレスポンス時間: 3秒以内

### 4.2 可用性要件
- Google Apps Scriptの稼働時間に依存
- エラー発生時の適切なログ出力
- 処理中断時の復旧可能性

### 4.3 セキュリティ要件
- Googleアカウントベースのアクセス制御
- スプレッドシート共有権限による利用者制限
- 売上データの適切な取り扱い

### 4.4 運用・保守要件
- GitHubでのソースコード管理
- バージョン管理による変更履歴追跡
- デプロイメント手順の標準化

## 5. 制約条件

### 5.1 技術制約
- Google Apps Scriptの実行時間制限（6分）
- Google Driveのファイルサイズ制限
- スプレッドシートの行数制限（1000万セル）

### 5.2 業務制約
- Amazonセラーセントラルのペイメントレポート形式に依存
- 月次処理での実行を想定
- 手動実行による運用（3段階のボタン操作）
- 重複データ処理時のスキップ仕様

### 5.3 データ制約
- CSVファイル形式の固定構造（A列9行目からデータ開始）
- 日付形式の統一（YYYY/MM/DD）
- 商品管理シートの列構造固定
- ステータス値の動的計算（IFS関数による4段階分類）

## 6. 成功基準

### 6.1 機能面
- CSV読込成功率: 99%以上
- データ転記精度: 100%
- エラーハンドリングの適切性

### 6.2 運用面
- 月次処理の安定実行
- 処理時間の短縮（手動作業比50%削減）
- ユーザビリティの向上

### 6.3 保守面
- コードの可読性・保守性
- GitHubでの適切なバージョン管理
- ドキュメントの整備

## 7. 想定リスク

### 7.1 技術リスク
- Google Apps Scriptの仕様変更
- Amazonレポート形式の変更
- スプレッドシートのパフォーマンス劣化

### 7.2 運用リスク
- 手動実行忘れ
- CSVファイルの選択ミス
- データ重複処理（重複検知機能で軽減）
- 3段階処理での中断リスク

### 7.3 データリスク
- 売上データの欠損
- 転記ミスによるデータ不整合
- バックアップの必要性

---

**作成日**: 2025年8月28日  
**バージョン**: 1.0  
**作成者**: Claude Sonnet 4